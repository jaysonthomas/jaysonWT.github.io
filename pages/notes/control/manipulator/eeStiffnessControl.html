
<!DOCTYPE html>
<html>
<head>
  <title>End-effector stiffness control</title>
  <meta name="End-effector stiffness control" content="text/html; charset=utf-8;" />
  <script type="text/javascript" src="../../../../logbook.js"></script>

  <script src="../../../../logbook-mathjax-config.js" defer></script> 
  <script type="text/javascript" id="MathJax-script" defer
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/atom-one-light.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <link rel="stylesheet" type="text/css" href="../../../../logbook.css" />
</head>

<body onload="loadChapter('');">  

  <div data-type="titlepage" pdf="no">
    <header>
      <h1><a href="../../../../index.html" style="text-decoration:none;">Logbook</a></h1>
      <p style="font-size: 18px;"><a href="../../../../pages/bio/jjwt.html">Jayson Wynne-Thomas</a></p>
      <p style="font-size: 14px; text-align: right;"> 
        Last modified <span id="last_modified"></span>.</br>
        <script>
        var d = new Date(document.lastModified);
        document.getElementById("last_modified").innerHTML = d.getFullYear() + "-" + (d.getMonth()+1) + "-" + d.getDate();</script>
      </p>
    </header>
  </div>
  
  <div id="main" class="sidebar1">
    <span style="font-size:10px;cursor:pointer" onclick="openNav()">&#9776;</span>
  </div>

  <div id="mySidenav" class="sidebar">
  
<a href="#0">Overview</a>
<a href="#1">Change of coordinates</a>
<a href="#2">Validity of the dynamics in the operation space</a>
<ul class="no-bullets">
  <li><a href="#2.0">Is $M_c(q)$ invertible?</a></li>
  <li><a href="#2.1">Null space of the controller (\ref{eq:resultOpSpaceForm})</a></li>
</ul>
</div>

<chapter style="counter-reset: chapter 0"><h1>End-effector stiffness control</h1>
<section id="0"><h1>Overview</h1>
  The aim is for the fingertip to act like a MSD. To achieve this, the controller would have to be implemented in the ee (instead of joint) coordinates; which means the dynamics would have to be considered in the ee coordinates instead of $q$. This is also called <i>cartesian stiffness control</i>.

  <p>
    For the end point to act like a MSD, the following dynamics needs to be imposed:
    $$\begin{equation}
      m\ddot{p}^c + b\dot{p}^c + k(p^c-p^{c_d}) = f^c_{ext}
    \label{eq:goal2}
    \end{equation}$$
  </p>
</section>

<section id="1"><h1>Change of coordinates</h1>
  The position of the end contact point of an arm is given by some kinematic function of its joint angles $q$, from which the velocity and acceleration (using chain rule) of the end contact point can be found.  
  $$\begin{align}
    p^c &= f_{kin}(q)                               \label{eq:position}\\
    \dot{p}^c &= J(q)\dot{q}                        \label{eq:velocity}\\
    \ddot{p}^c &= J(q)\ddot{q} + \dot{J}(q)\dot{q}  \label{eq:accel}\\
  \end{align}$$

  From the principle of virtual work, the applied joint torques is conserved as the applied translational forces at the end-effector:
  $$\begin{equation}
    u = J^T(q) f^c    \label{eq:jTorque}
  \end{equation}$$

  The manipulator equation in joint coordinates can be changed to end-effector coordinates by substituting \ref{eq:manipulator}, \ref{eq:jTorque} into \ref{eq:position}, \ref{eq:velocity}, \ref{eq:accel}:
  \begin{align}
    M(q)\ddot{q} + C(q,\dot{q})\dot{q} &= 
    \tau_g(q) + u + \sum_i J^T_i(q)f^{c_i}          \label{eq:manipulator}\\
    
    M_c(q)\ddot{p}^c + C_c(q, \dot{q})\dot{q} &=
    f^c_g(q) + f^c_u + f^c_{ext}                     \nonumber
  \end{align}

  $M_c(q) = (J M^{-1} J^T)^{-1}$ <br>
  $C_c(q,\dot{q}) = M_c \left(J M^{-1} C+ \dot{J} \right)$ <br>
  $f^c_g(q) = M_c J M^{-1} \tau_g$

  <p>
    $M_c$ is the EE mass or the effective mass. <br>
    $M$ is the mass of the original system. <br>
    $M^{-1}$ is the shorthand for $M^{-1}(q)$ <br>
    $J$ is the shorthand for $J^c(q)$
  </p>

  This transformation is often called <i>operation space form of the dynamics</i>. It is now possible to use feedback cancellation with this new dynamics in the operation/EE space.
</section>

<section id="2"><h1>Validity of the dynamics in the operation space</h1>
  <subsection id="2.0"><h1>Is $M_c(q)$ invertible?</h1>
    In general, $(AA^T)^{-1}$ exists if $A$ has full row rank. For $(J M^{-1} J^T)^{-1}$ to be invertible, $J$ would have to be full row rank. There are singular configurations like when the arm is stretched out, where it does not. But in all reasonable parts of the workspace, $J$ tends to be. 

    <p>
      For instance it could be: $J(q)=3\times nq$ if we're trying to do EE stuff; 
      it tends to be full row rank and low column rank because it's a long short matrix. 
      The mass matrix is positive definite so that is going to be well conditioned too.
    </p>

    So, the matrix should have an inverse as long as $J$ doesn't go singular; which is as 
    it should be intuitively. If we just try to start jamming $J$ transpose in our EoM
    we'll get stuck. But it must be the case that if we were to push on the EE of a 
    physical contraption it will push back on us with some physical force. The force that 
    it pushes back with is configuration (LHS of (\ref{eq:resultOpSpaceForm})) dependent 
    - there will be some big complicated set of mass which will more or less work 
    against me in each axis depending on the configuration of the mass.

    <p>
      What is the ability of the arm to produce force at the EE in a singular configuration? 
      The controller can't produce force in the direction the arm is stretched out 
      instantaneously but it can produce a forced dot. So we have to be careful if we start 
      writing controllers similar to (\ref{eq:resultOpSpaceForm}) in such singular 
      configurations - people tend to write it in a constrained least squares form and 
      put some boundaries on it. Try not to take the inverse of the Jacobian as in 
      (\ref{eq:opSpaceForm}) in singular conditions or be careful about it. 
    </p>
  </subsection>

  <subsection id="2.1"><h1>Null space of the controller (\ref{eq:resultOpSpaceForm})</h1>
    If we write a controller that tells the robot to act like a certain dynamics in the 
    xyz configuration, but say the robot has 7 DOF, then we've still got to specify 
    something for the joints (so that the joints don't get into an odd configuration and 
    bump somewhere for example). The same way in our Jacobian based controller, we talked 
    about putting a secondary objective in the null space (something for instance to stay 
    in a comfortable joint configuration, example: EE position is fixed, but joints are moving) 
    we need to do something similar to stabilise the null space of this controller too.

    <p>
      So choose $u_c$ such that (\ref{eq:resultOpSpaceForm}) almost 
      equals (\ref{eq:goal2}):

      $$
        M_c(q)\ddot{p}^c + C(q, \dot{q}) + K_p(p^c - p^{c^d}) + .. = 
      $$
      And I think, also add in nullspace stabilisation to the mix.
    </p>

    The fact that we tend to not change $M$, $C$ and that they are configuration dependent, 
    means that, instantaneously, we can make our robot act like a MSD system. The mass 
    that it acts like though will be configuration dependent. Almost always! In the 
    quasi-static analysis case, if the accelerations are small, if we're going to push 
    and see how far the robot deflects (i.e. how much we can push it) before it hits a 
    new steady state and stops, the mass doesn't matter there; the inertial terms 
    don't matter in the static analysis. But in the dynamic analysis, if we start trying to 
    understand the dynamics of our robot then $M$ and $C$ are going to be notable; 
    maybe not hugely important. It would be beautiful and clean to make them somehow constant, 
    a function of $q$ but we tend to not do that. There are theoretical limits on how 
    much we can change the mass before we write a controller that is unstable. 
    Neville Hogan has some great surveys on that.
  </subsection>
</section>
</chapter>

</body>
</html>
