
<!DOCTYPE html>
<html>
<head>
  <title>Drone dynamics</title>
  <meta name="Drone dynamics" content="text/html; charset=utf-8;" />
  <script type="text/javascript" src="../../../../logbook.js"></script>

  <script src="../../../../logbook-mathjax-config.js" defer></script> 
  <script type="text/javascript" id="MathJax-script" defer
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/atom-one-light.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <link rel="stylesheet" type="text/css" href="../../../../logbook.css" />
</head>

<body onload="loadChapter('');">  

  <div data-type="titlepage" pdf="no">
    <header>
      <h1><a href="../../../../index.html" style="text-decoration:none;">Logbook</a></h1>
      <p style="font-size: 18px;"><a href="../../../../pages/bio/jjwt.html">Jayson Wynne-Thomas</a></p>
      <p style="font-size: 14px; text-align: right;"> 
        Last modified <span id="last_modified"></span>.</br>
        <script>
        var d = new Date(document.lastModified);
        document.getElementById("last_modified").innerHTML = d.getFullYear() + "-" + (d.getMonth()+1) + "-" + d.getDate();</script>
      </p>
    </header>
  </div>
  
  <div id="main" class="sidebar1">
    <span style="font-size:10px;cursor:pointer" onclick="openNav()">&#9776;</span>
  </div>

  <div id="mySidenav" class="sidebar">
  
<a href="#0">Forces acting on a drone</a>
<ul class="no-bullets">
  <li><a href="#0.0">Thrust and gravity</a></li>
  <li><a href="#0.1">Drag</a></li>
</ul>
<a href="#1">Moments</a>
<a href="#2">Equilibrium (Balanced forces)</a>
<ul class="no-bullets">
  <li><a href="#2.0">Translational equilibrium</a></li>
  <li><a href="#2.1">Rotational equilibrium</a></li>
</ul>
<a href="#3">Acceleration (Unbalanced forces)</a>
<ul class="no-bullets">
  <li><a href="#3.0">Linear translational acceleration</a></li>
  <li><a href="#3.1">Rotational acceleration</a></li>
</ul>
<a href="#4">The rotors</a>
<ul class="no-bullets">
  <li><a href="#4.0">Forces and Moments</a></li>
  <li><a href="#4.1">Lift constants</a></li>
  <li><a href="#4.2">Example 1</a></li>
  <li><a href="#4.3">Example 2</a></li>
</ul>
<a href="#5">Advancing the state of the vehicle</a>
<ul class="no-bullets">
  <li><a href="#5.0">Functions to write</a></li>
  <li><a href="#5.1">Figure out the state variables</a></li>
  <li><a href="#5.2">Plots</a></li>
</ul>
</div>

<chapter style="counter-reset: chapter 0"><h1>Drone dynamics</h1>

<section id="0"><h1>Forces acting on a drone</h1>
  <subsection id="0.0"><h1>Thrust and gravity</h1>
    To hover, a quadrotor exerts an overall force upwards which is equal in size to the force that gravity exerts downwards. <i>Thrust</i> is the upward force generated by each of the rotors as they spin through air. <i>Weight</i> is the force due to gravity.

    <subsubsection><h1>Magnitude and direction of gravity</h1>
      The force of gravity always points straight downwards toward the centre of the earth. Its strength is given by:
      $$
        mg
      $$
      $m$ is the mass of the quadrotor. <br>
      $g$ is the acceleration due to gravity, which is $~9.81 m/s^2$. This is the rate at which an object will accelerate downwards when it's dropped on earth.

      <div class="container">
        <figure>
          <img style="height:60px; width:auto"
          src="../../../../figures/drone/29_gravity.png"/>
          <figcaption>
            Direction of gravity
          </figcaption>
        </figure>
      </div>
    </subsubsection>

    <subsubsection><h1>Magnitude and direction of thrust</h1>
      The strengths of the thrust vectors depend on the size and shape of the rotor's plates and on how fast they are spinning. The direction of a rotor's thrust vector is always perpendicular to the plane that the rotor is spinning in. When we control a quadrotor, all we actually get is to control the magnitude of these four thrust vectors.

      <div class="container">
        <figure>
          <img style="height:50px; width:auto"
          src="../../../../figures/drone/30_thrust.png"/>
          <figcaption>
            Direction of thrust
          </figcaption>
        </figure>
      </div>
    </subsubsection>
  </subsection>

  <subsection id="0.1"><h1>Drag</h1>
    <i>Drag</i> is a friction force (due to air resistance) caused by the motion of a body through a fluid such as air. For example, the quadrotor experiences a drag force because of the difference in velocity between the vehicle body and the air. And there's even drag related to each propeller's individual motion. 

    <p>
      In practice, we usually treat drag as a disturbance when designing quadrotor controllers, and don't model it explicitly as the effects are relatively small at lower vehicle and wind speeds and because it's difficult to identify the correct drag model. 
    </p>
  </subsection>
</section>

<section id="1"><h1>Moments</h1>
  [<a href="https://t.ly/i02K">Monorotor spinning sim video</a>] <br>
  In a quadrotor, one set of rotor plates provide upward thrust when spinning clockwise and the other, when spinning CCW. These propellers are placed in a configuration where adjacent rotors always spin in the opposite directions. A drone has 0 rotation or yaw when all its rotors are spinning at the same rate such that CW torques exactly balance the CCW torques. The rotors that spin clockwise, introduce a CCW moment, and vice versa. When the clockwise rotors spin faster than the CCW ones, the CCW moment produced by those clockwise rotors will dominate, and the drone will yaw in the CCW direction.
</section>

<section id="2"><h1>Equilibrium (Balanced forces)</h1>
  Let's take the example of a monorotor hovering.

  <subsection id="2.0"><h1>Translational equilibrium</h1>
    A monorotor has only one rotor, which means there's only one thrust vector. When a monorotor is hovering, it's in a state called <i>translational equilibrium</i> i.e. it's not experiencing any translational acceleration (net force is 0). A translation is any non-rotational motion. So, zero translational acceleration means an object isn't accelerating towards the left or right, up or down and forward or backward.

    <div class="container">
      <figure>
        <img style="height:60px; width:auto"
        src="../../../../figures/drone/31_ex1_monorotor.png"/>
        <figcaption>
          Calculate mass and thrust.
        </figcaption>
      </figure>
    </div>
    
    If the weight vector of a monorotor is 100 newtons down, then if it's hovering, the thrust must be 100 newtons up. Mass = $\frac{100}{9.8}$ = $~10.2kg$ -> pretty big quadrotor. 
    
    It's impossible for a monorotor to sit truly motionless in the sky because it can never be in rotational equilibrium. 
  </subsection>

  <subsection id="2.1"><h1>Rotational equilibrium</h1>
    Where does the rotation of the monorotor body come from? In addition to causing a thrust force, a rotating propeller also introduces a <i>moment</i> or <i>torque</i>. A rotor that's spinning clockwise will produce a moment that causes the body to spin counter-clockwise. When we design a flying aircraft, we generally don't want the spinning behaviour. 
  </subsection>
</section>

<section id="3"><h1>Acceleration (Unbalanced forces)</h1>
  <subsection id="3.0"><h1>Linear translational acceleration</h1>
    When an object experiences an unbalanced force, it accelerates in the direction of the net force.

    $$
      F = ma
    $$
    $F$ is the <n>net</n> force acting on the object.<br> 
    $a$ is acceleration measured in an inertial frame, i.e. a reference frame that is not accelerating, like the world frame.<br>
    $F$ and $a$ are vectors and can be analysed on a pure direction basis. So, if we look in the vertical direction for a monorotor, then the z component of force will cause an acceleration in the z direction:

    $$
      F_z = m\ddot{z}
    $$

    <div class="container">
      <figure>
        <img style="height:80px; width:auto"
        src="../../../../figures/drone/32_translationalAccel.png"/>
        <figcaption>
          If a monorotor with a mass of 2kg has these forces acting on it, the net force would be 23.6-19.6, or 4N. This would cause an acceleration of 2$m/s^2$. 
        </figcaption>
      </figure>
    </div>

  </subsection>

  <subsection id="3.1"><h1>Rotational acceleration</h1>
    Unbalanced moments cause rotational acceleration. The equation that relates these quantities:

    $$
      \tau = I \alpha
    $$
    
    $\tau$ is the net torque [used interchangeably with moment] around a given axis. <br>
    $\alpha$ [$\frac{rad}{sec^2}$] is the angular acceleration about the same axis; it gives an indication of how fast the rotational speed is changing. Both are vectors.
    
    <p>
      $I$, the <i>Moment of Inertia</i>, is a measure of how hard it is to change an object's <n>rotational velocity</n> about a particular axis. It can be different for each axis. To describe the three-dimensional quadrotor motion, the moment of inertia will be a $3\times 3$ matrix.
    </p>

    It is easier to think about one axis of rotation at a time. In the world of quadrotor dynamics, people tend to use the word moment over torque. Greek letter psi is used to represent yaw. So, another way to write the torque equation (since it's a monorotor, we only consider the z-axis):
    
    $$
      M_z = I_z \ddot\psi
    $$
  </subsection>
</section>

<section id="4"><h1>The rotors</h1>
  <subsection id="4.0"><h1>Forces and Moments</h1>
    What are the magnitudes of the moments and forces that the spinning rotors produce?  

    $$\begin{gather*}
      F &\propto &\omega^2 \\
      &=& k_f \omega^2 \\

      M &\propto &\omega^2 \\
      &=& k_m \omega^2
    \end{gather*}$$
    
    $\omega$ represents the rotation rate of a rotor in $\frac{rad}{s}$. When $\omega = 2\pi$, the rotor is doing one rotation per second. It turns out that when a rotor spins for the rotation rate of $\omega$, the thrust produced and the induced moment are both proportional to $\omega^2$.
  </subsection>

  <subsection id="4.1"><h1>Lift constants</h1>
    The constants of proportionality, $k_f$ is the <i>thrust coefficient</i>, and $k_m$ is the <i>angular torque coefficient</i>. The actual values of these constants depend on:
    <ul>
      <li>the size and shape of the plates</li>
      <li>the specific motors used</li>
      <li>the density of the surrounding air they operate in</li>
    </ul> 
    
    In practice, we obtain these values empirically. We mount the motor and propeller on a load cell and measure the force and moment for different motor speeds. The graph below shows a simulation of the data you might get from such an experiment.

    <div class="container">
      <figure>
        <img style="height:150px; width:auto"
        src="../../../../figures/drone/33_liftConstants.png"/>
        <figcaption>
          Lift constants empirical data
        </figcaption>
      </figure>
    </div>
    
    Based on the Force vs $\omega$ graph shown above, the $k_f$ for the particular propeller is 0.007. If we double the rotation speed of a rotor, the thrust increases by a factor of 4.
  </subsection>

  <p></p>
  <button class="accordion">Examples</button>
  <div class="panel">
  <subsection id="4.2"><h1>Example 1</h1>
      A co-axial helicopter is just a body with two rotors on top of each other which produce upward thrusts by spinning in opposite directions. Let rotor 1 spin CW with $\omega_1$ and rotor 2 spin CCW with $\omega_2$. Find $\ddot{z}$ and $\ddot\psi$.

      <p>
        Mass, $m = 1.0kg$ <br>
        Moment of inertia, $I_z = 2.0kgm^2$<br>
        Force constant of proportionality, $k_f = 0.1$<br>
        Moment constant of proportionality, $k_m = 0.2$<br>
        Rotation rate of propeller 1, $\omega_1 = 10.0rad/s$<br>
        Rotation rate of propeller 2, $\omega_2 = 8.0rad/s$
      </p>

      Resulting vertical linear acceleration:
      $$\begin{align*}
        \ddot{z} &= \frac{F_{net}}{m} \\
              &= \frac{1}{m}(mg - F_{thrust}) \\
              &= \frac{1}{m}(mg - k_f(\omega_1^2 + \omega_2^2)) \\
              &= g - \frac{k_f}{m}(\omega_1^2 + \omega_2^2) \\
              &= -6.6 m/s^2
      \end{align*}$$

      <p>
        Resulting rotational/angular acceleration:
        $$\begin{align*}
        \ddot{\psi} &= \frac{M_{z}}{I_z} \\
              &= \frac{k_m}{I_z}(\omega_2^2 - \omega_1^2) \\
              &= -3.6 rad/s^2
      \end{align*}$$
      </p>

      If rotor 1 (top) spins faster than rotor 2, then the body of the vehicle experiences angular acceleration in the CCW direction! The body and the propeller would be spinning in opposite directions to each other. Both $\ddot{z}$ and $\ddot\psi$ are along the z axis. $\omega_1^2$ is given a negative sign because we only consider the reaction torque similar to the direction of the thrust - we expel air downwards but consider the motion in the opposite direction. The positive z axis points downwards. When we curl, the thumb points in the positive z direction.
    </subsection>

  <subsection id="4.3"><h1>Example 2</h1>
      What thrust would a 2.2 kg monorotor need in order to accelerate upwards at -4.0m/s2 (remember, z is positive downwards)? 30.4N
    </subsection>
  </div>
</section>

<section id="5"><h1>Advancing the state of the vehicle</h1>
  When we are able to implement a function that advances the state of a vehicle forward in time, it means we understand how all the forces impact the motion of the vehicle, i.e. the dynamics of the system. 

  <subsection id="5.0"><h1>Functions to write</h1>
    Write the function in 2 stages:
    <ul>
      <li>Uncontrolled motion</li>
      The rotors aren't spinning and the vehicle is purely under the influence of gravity in this case.

      <p>
        <li>Controlled motion</li>
      </p>
    </ul>
  </subsection>

  <subsection id="5.1"><h1>Figure out the state variables</h1>
    Forces directly affect the acceleration of the system. The question is: what accelerations does the system experience? How do these effect the system.

    <p>
      Any kind of acceleration advances the state forward in time by dt seconds. It first changes the velocity which changes the position. So, these 2 variables need to be part of our state.
    </p>

    If the rotors were spinning, there would be rotational velocity and angle included in the state variables. To keep track of state in 3D, there would be 3*4 (since there are 4 for the 1D case) variables/equations.
  </subsection>

  <subsection id="5.2"><h1>Plots</h1>
    Plot position/velocity vs time curve! Refer advance_state_uncontrolled_0.
  </subsection>
</section>
</chapter>

</body>
</html>
